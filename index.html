<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mitya AI - Web Control</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #121212; color: #eee; margin: 0; display: flex; flex-direction: column; height: 100vh; }
        #header { padding: 15px; background: #1e1e1e; display: flex; gap: 10px; align-items: center; border-bottom: 1px solid #333; }
        #chat { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 15px; }
        .msg { padding: 12px 18px; border-radius: 12px; max-width: 80%; line-height: 1.4; }
        .user { background: #0078d4; align-self: flex-end; }
        .ai { background: #2d2d2d; align-self: flex-start; border: 1px solid #444; }
        .input-area { padding: 20px; background: #1e1e1e; display: flex; gap: 10px; }
        input { flex: 1; padding: 12px; border-radius: 8px; border: 1px solid #444; background: #000; color: white; }
        select { padding: 10px; border-radius: 8px; background: #000; color: white; border: 1px solid #444; }
        button { padding: 10px 20px; background: #28a745; color: white; border: none; border-radius: 8px; cursor: pointer; }
    </style>
</head>
<body>
    <div id="header">
        <span>Модель:</span>
        <select id="modelSelect">
            <option value="qwen3:8b">Qwen 3 (8B)</option>
            <option value="qwen2.5-coder:7b">Qwen 2.5 Coder</option>
            <option value="gemma3:4b">Gemma 3 (4B)</option>
            <option value="gemma3:270m">Gemma 3 (Tiny)</option>
        </select>
        <div id="status" style="margin-left: auto; font-size: 12px; color: #888;">Online</div>
    </div>

    <div id="chat"></div>

    <div class="input-area">
        <input type="text" id="userInput" placeholder="Спроси что-нибудь у своей RTX 2070...">
        <button onclick="sendMsg()" id="sendBtn">Лететь!</button>
    </div>

    <script>
        const TUNNEL_URL = 'https://mitya-ai.loca.lt'; 

        async function sendMsg() {
            const input = document.getElementById('userInput');
            const chat = document.getElementById('chat');
            const btn = document.getElementById('sendBtn');
            const model = document.getElementById('modelSelect').value;

            if (!input.value) return;

            const text = input.value;
            chat.innerHTML += `<div class="msg user">${text}</div>`;
            input.value = '';
            btn.disabled = true;

            try {
                const response = await fetch(`${TUNNEL_URL}/api/generate`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        model: model,
                        prompt: text,
                        stream: false
                    })
                });

                const data = await response.json();
                chat.innerHTML += `<div class="msg ai">${data.response}</div>`;
                chat.scrollTop = chat.scrollHeight;
            } catch (e) {
                chat.innerHTML += `<div class="msg ai" style="color:red">Ошибка: проверь туннель!</div>`;
            } finally {
                btn.disabled = false;
            }
        }
    </script>
</body>
</html>